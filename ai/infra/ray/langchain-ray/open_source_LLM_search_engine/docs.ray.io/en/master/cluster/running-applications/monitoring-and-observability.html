
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Cluster Monitoring &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/js/versionwarning.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../../_static/js/docsearch.js"></script>
    <script src="../../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../../_static/js/termynal.js"></script>
    <script defer="defer" src="../../_static/js/custom.js"></script>
    <script defer="defer" src="../../_static/js/top-navigation.js"></script>
    <script src="../../_static/js/tags.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script async="async" src="../../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/cluster/running-applications/monitoring-and-observability.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Programmatic Cluster Scaling" href="autoscaling/reference.html" />
    <link rel="prev" title="Ray Client: Interactive Development" href="job-submission/ray-client.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>


  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.com", "build_date": "2023-04-28T22:30:10Z", "builder": "sphinx", "canonical_url": null, "commit": "ff36b8e7", "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-2", "language": "en", "page": "cluster/running-applications/monitoring-and-observability", "programming_language": "py", "project": "anyscale-ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/getting-started.html">
   Getting Started Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-more-libs/index.html">
   More Libraries
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../../ray-core/cluster/index.html">
   Ray Clusters
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../key-concepts.html">
     Key Concepts
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../kubernetes/index.html">
     Deploying on Kubernetes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../vms/index.html">
     Deploying on VMs
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Applications Guide
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="job-submission/index.html">
       Ray Jobs Overview
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="monitoring-and-observability.html#">
       Cluster Monitoring
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="autoscaling/reference.html">
       Programmatic Cluster Scaling
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../faq.html">
     FAQ
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../package-overview.html">
     Ray Cluster Management API
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-observability/monitoring-debugging/monitoring-debugging.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fcluster/running-applications/monitoring-and-observability.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/cluster/running-applications/monitoring-and-observability.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/cluster/running-applications/monitoring-and-observability.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#monitoring-the-cluster-via-the-dashboard">
   Monitoring the cluster via the dashboard
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#using-ray-cluster-cli-tools">
   Using Ray Cluster CLI tools
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#prometheus">
   Prometheus
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#scraping-metrics">
     Scraping metrics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#auto-discovering-metrics-endpoints">
     Auto-discovering metrics endpoints
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#manually-discovering-metrics-endpoints">
     Manually discovering metrics endpoints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#grafana">
   Grafana
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#using-an-existing-grafana-instance">
     Using an existing Grafana instance
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Cluster Monitoring</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#monitoring-the-cluster-via-the-dashboard">
   Monitoring the cluster via the dashboard
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#using-ray-cluster-cli-tools">
   Using Ray Cluster CLI tools
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#prometheus">
   Prometheus
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#scraping-metrics">
     Scraping metrics
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#auto-discovering-metrics-endpoints">
     Auto-discovering metrics endpoints
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#manually-discovering-metrics-endpoints">
     Manually discovering metrics endpoints
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="monitoring-and-observability.html#grafana">
   Grafana
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="monitoring-and-observability.html#using-an-existing-grafana-instance">
     Using an existing Grafana instance
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="cluster-monitoring">
<h1>Cluster Monitoring<a class="headerlink" href="monitoring-and-observability.html#cluster-monitoring" title="Permalink to this headline">#</a></h1>
<p>Ray ships with the following observability features:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../ray-core/ray-dashboard.html#ray-dashboard"><span class="std std-ref">The dashboard</span></a>, for viewing cluster state.</p></li>
<li><p>CLI tools such as the <a class="reference internal" href="../../ray-observability/state/state-api.html#state-api-overview-ref"><span class="std std-ref">Ray state APIs</span></a> and <a class="reference internal" href="../vms/references/ray-cluster-cli.html#monitor-cluster"><span class="std std-ref">ray status</span></a>, for checking application and cluster status.</p></li>
<li><p><a class="reference internal" href="monitoring-and-observability.html#multi-node-metrics"><span class="std std-ref">Prometheus metrics</span></a> for internal and custom user-defined metrics.</p></li>
</ol>
<p>For more information on these tools, check out the more comprehensive <a class="reference internal" href="../../ray-observability/monitoring-debugging/monitoring-debugging.html#observability"><span class="std std-ref">Observability guide</span></a>.</p>
<p>The rest of this page will focus on how to access these services when running a Ray Cluster.</p>
<section id="monitoring-the-cluster-via-the-dashboard">
<span id="monitor-cluster-via-dashboard"></span><h2>Monitoring the cluster via the dashboard<a class="headerlink" href="monitoring-and-observability.html#monitoring-the-cluster-via-the-dashboard" title="Permalink to this headline">#</a></h2>
<p><a class="reference internal" href="../../ray-core/ray-dashboard.html#ray-dashboard"><span class="std std-ref">The dashboard</span></a> provides detailed information about the state of the cluster,
including the running jobs, actors, workers, nodes, etc.
By default, the <a class="reference internal" href="../vms/getting-started.html#vm-cluster-quick-start"><span class="std std-ref">cluster launcher</span></a> and <a class="reference internal" href="../kubernetes/getting-started.html#kuberay-quickstart"><span class="std std-ref">KubeRay operator</span></a> will launch the dashboard, but will
not publicly expose the port.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
If using the VM cluster launcher</label><div class="sd-tab-content docutils">
<p>You can securely port-forward local traffic to the dashboard via the <code class="docutils literal notranslate"><span class="pre">ray</span>
<span class="pre">dashboard</span></code> command.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ray dashboard <span class="o">[</span>-p &lt;port, <span class="m">8265</span> by default&gt;<span class="o">]</span> &lt;cluster config file&gt;
</pre></div>
</div>
<p>The dashboard will now be visible at <code class="docutils literal notranslate"><span class="pre">http://localhost:8265</span></code>.</p>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-1">
If using Kubernetes</label><div class="sd-tab-content docutils">
<p>The KubeRay operator makes the dashboard available via a Service targeting
the Ray head pod, named <code class="docutils literal notranslate"><span class="pre">&lt;RayCluster</span> <span class="pre">name&gt;-head-svc</span></code>. You can access the
dashboard from within the Kubernetes cluster at <code class="docutils literal notranslate"><span class="pre">http://&lt;RayCluster</span> <span class="pre">name&gt;-head-svc:8265</span></code>.</p>
<p>You can also view the dashboard from outside the Kubernetes cluster by
using port-forwarding:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ kubectl port-forward service/raycluster-autoscaler-head-svc <span class="m">8265</span>:8265
</pre></div>
</div>
<p>For more information about configuring network access to a Ray cluster on
Kubernetes, see the <a class="reference internal" href="../kubernetes/user-guides/config.html#kuberay-networking"><span class="std std-ref">networking notes</span></a>.</p>
</div>
</div>
</section>
<section id="using-ray-cluster-cli-tools">
<h2>Using Ray Cluster CLI tools<a class="headerlink" href="monitoring-and-observability.html#using-ray-cluster-cli-tools" title="Permalink to this headline">#</a></h2>
<p>Ray provides several CLI tools for observing the current cluster and
application state.  The <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">status</span></code> command provides information about the
current status of nodes in the cluster, as well as information about
autoscaling. Other Ray CLI tools allow you to read logs across the cluster and
summarize application state such as the currently running tasks and actors.
These tools are summarized <a class="reference internal" href="../../ray-observability/state/state-api.html#state-api-overview-ref"><span class="std std-ref">here</span></a>.</p>
<p>These CLI commands can be run on any node in a Ray Cluster. Examples for
executing these commands from a machine outside the Ray Cluster are provided
below.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-2" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-2">
If using the VM cluster launcher</label><div class="sd-tab-content docutils">
<p>Execute a command on the cluster using <code class="docutils literal notranslate"><span class="pre">ray</span> <span class="pre">exec</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ray <span class="nb">exec</span> &lt;cluster config file&gt; <span class="s2">&quot;ray status&quot;</span>
</pre></div>
</div>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-1" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-3">
If using Kubernetes</label><div class="sd-tab-content docutils">
<p>Execute a command on the cluster using <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">exec</span></code> and the configured
RayCluster name. We will use the Service targeting the Ray head pod to
execute a CLI command on the cluster.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, find the name of the Ray head service.</span>
$ kubectl get pod <span class="p">|</span> grep &lt;RayCluster name&gt;-head
<span class="c1"># NAME                                             READY   STATUS    RESTARTS   AGE</span>
<span class="c1"># &lt;RayCluster name&gt;-head-xxxxx                     2/2     Running   0          XXs</span>

<span class="c1"># Then, use the name of the Ray head service to run `ray status`.</span>
$ kubectl <span class="nb">exec</span> &lt;RayCluster name&gt;-head-xxxxx -- ray status
</pre></div>
</div>
</div>
</div>
</section>
<section id="prometheus">
<span id="multi-node-metrics"></span><h2>Prometheus<a class="headerlink" href="monitoring-and-observability.html#prometheus" title="Permalink to this headline">#</a></h2>
<p>Ray supports Prometheus for emitting and recording time-series metrics.
See <a class="reference internal" href="../../ray-core/ray-metrics.html#ray-metrics"><span class="std std-ref">metrics</span></a> for more details of the metrics emitted.
To use Prometheus in a Ray cluster, decide where to host it, then configure
it so that it can scrape the metrics from Ray.</p>
<section id="scraping-metrics">
<h3>Scraping metrics<a class="headerlink" href="monitoring-and-observability.html#scraping-metrics" title="Permalink to this headline">#</a></h3>
<p>Ray runs a metrics agent per node to export <a class="reference internal" href="../../ray-core/ray-metrics.html#ray-metrics"><span class="std std-ref">metrics</span></a> about Ray core as well as
custom user-defined metrics. Each metrics agent collects metrics from the local
node and exposes these in a Prometheus format. You can then scrape each
endpoint to access Ray’s metrics.</p>
<p>To scrape the endpoints, we need to ensure service discovery, allowing
Prometheus to find the metrics agents’ endpoints on each node.</p>
</section>
<section id="auto-discovering-metrics-endpoints">
<h3>Auto-discovering metrics endpoints<a class="headerlink" href="monitoring-and-observability.html#auto-discovering-metrics-endpoints" title="Permalink to this headline">#</a></h3>
<p>You can allow Prometheus to dynamically find endpoints it should scrape by using Prometheus’ <a class="reference external" href="https://prometheus.io/docs/guides/file-sd/#installing-configuring-and-running-prometheus">file based service discovery</a>.
This is the recommended way to export Prometheus metrics when using the Ray <a class="reference internal" href="../vms/getting-started.html#vm-cluster-quick-start"><span class="std std-ref">cluster launcher</span></a>, as node IP addresses can often change as the cluster scales up and down.</p>
<p>Ray auto-generates a Prometheus <a class="reference external" href="https://prometheus.io/docs/guides/file-sd/#installing-configuring-and-running-prometheus">service discovery file</a> on the head node to facilitate metrics agents’ service discovery.
This allows you to scrape all metrics in the cluster without knowing their IPs. Let’s walk through how to acheive this.</p>
<p>The service discovery file is generated on the <a class="reference internal" href="../key-concepts.html#cluster-head-node"><span class="std std-ref">head node</span></a>. On this node, look for <code class="docutils literal notranslate"><span class="pre">/tmp/ray/prom_metrics_service_discovery.json</span></code> (or the eqiuvalent file if using a custom Ray <code class="docutils literal notranslate"><span class="pre">temp_dir</span></code>).
Ray will periodically update this file with the addresses of all metrics agents in the cluster.</p>
<p>Ray automatically produces a Prometheus config which scrapes the file for service discovery found at <code class="xref py py-obj docutils literal notranslate"><span class="pre">/tmp/ray/session_latest/metrics/prometheus/prometheus.yml</span></code>.
You can choose to use this config or modify your own to enable this behavior. The details of the config can be seen below and full documentation can be found at <code class="xref py py-obj docutils literal notranslate"><span class="pre">here</span></code>.</p>
<p>With this config, Prometheus will automatically update the addresses that it scrapes based on the contents of Ray’s service discovery file.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prometheus config file</span><span class="w"></span>

<span class="c1"># my global config</span><span class="w"></span>
<span class="nt">global</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">scrape_interval</span><span class="p">:</span><span class="w">     </span><span class="l l-Scalar l-Scalar-Plain">2s</span><span class="w"></span>
<span class="w">  </span><span class="nt">evaluation_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2s</span><span class="w"></span>

<span class="c1"># Scrape from Ray.</span><span class="w"></span>
<span class="nt">scrape_configs</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">job_name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;ray&#39;</span><span class="w"></span>
<span class="w">  </span><span class="nt">file_sd_configs</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">files</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&#39;/tmp/ray/prom_metrics_service_discovery.json&#39;</span><span class="w"></span>
</pre></div>
</div>
</section>
<section id="manually-discovering-metrics-endpoints">
<h3>Manually discovering metrics endpoints<a class="headerlink" href="monitoring-and-observability.html#manually-discovering-metrics-endpoints" title="Permalink to this headline">#</a></h3>
<p>If you already know the IP addresses of all nodes in your Ray Cluster, you can
configure Prometheus to read metrics from a static list of endpoints. To
do this, first set a fixed port that Ray should use to export metrics.  If
using the cluster launcher, pass <code class="docutils literal notranslate"><span class="pre">--metrics-export-port=&lt;port&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">ray</span>
<span class="pre">start</span></code>.  If using KubeRay, you can specify
<code class="docutils literal notranslate"><span class="pre">rayStartParams.metrics-export-port</span></code> in the RayCluster configuration file.
The port must be specified on all nodes in the cluster.</p>
<p>If you do not know the IP addresses of the nodes in your Ray cluster,
you can also programmatically discover the endpoints by reading the
Ray Cluster information. Here, we will use a Python script and the
<code class="docutils literal notranslate"><span class="pre">ray.nodes()</span></code> API to find the metrics agents’ URLs, by combining the
<code class="docutils literal notranslate"><span class="pre">NodeManagerAddress</span></code> with the <code class="docutils literal notranslate"><span class="pre">MetricsExportPort</span></code>. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># On a cluster node:</span>
<span class="kn">import</span> <span class="nn">ray</span>
<span class="n">ray</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">nodes</span><span class="p">())</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The &lt;NodeManagerAddress&gt;:&lt;MetricsExportPort&gt; from each of these entries</span>
<span class="sd">should be passed to Prometheus.</span>
<span class="sd">[{&#39;Alive&#39;: True,</span>
<span class="sd">  &#39;MetricsExportPort&#39;: 8080,</span>
<span class="sd">  &#39;NodeID&#39;: &#39;2f480984702a22556b90566bdac818a4a771e69a&#39;,</span>
<span class="sd">  &#39;NodeManagerAddress&#39;: &#39;192.168.1.82&#39;,</span>
<span class="sd">  &#39;NodeManagerHostname&#39;: &#39;host2.attlocal.net&#39;,</span>
<span class="sd">  &#39;NodeManagerPort&#39;: 61760,</span>
<span class="sd">  &#39;ObjectManagerPort&#39;: 61454,</span>
<span class="sd">  &#39;ObjectStoreSocketName&#39;: &#39;/tmp/ray/session_2020-08-04_18-18-16_481195_34255/sockets/plasma_store&#39;,</span>
<span class="sd">  &#39;RayletSocketName&#39;: &#39;/tmp/ray/session_2020-08-04_18-18-16_481195_34255/sockets/raylet&#39;,</span>
<span class="sd">  &#39;Resources&#39;: {&#39;CPU&#39;: 1.0,</span>
<span class="sd">                &#39;memory&#39;: 123.0,</span>
<span class="sd">                &#39;node:192.168.1.82&#39;: 1.0,</span>
<span class="sd">                &#39;object_store_memory&#39;: 2.0},</span>
<span class="sd">  &#39;alive&#39;: True},</span>
<span class="sd">{&#39;Alive&#39;: True,</span>
<span class="sd"> &#39;MetricsExportPort&#39;: 8080,</span>
<span class="sd"> &#39;NodeID&#39;: &#39;ce6f30a7e2ef58c8a6893b3df171bcd464b33c77&#39;,</span>
<span class="sd"> &#39;NodeManagerAddress&#39;: &#39;192.168.1.82&#39;,</span>
<span class="sd"> &#39;NodeManagerHostname&#39;: &#39;host1.attlocal.net&#39;,</span>
<span class="sd"> &#39;NodeManagerPort&#39;: 62052,</span>
<span class="sd"> &#39;ObjectManagerPort&#39;: 61468,</span>
<span class="sd"> &#39;ObjectStoreSocketName&#39;: &#39;/tmp/ray/session_2020-08-04_18-18-16_481195_34255/sockets/plasma_store.1&#39;,</span>
<span class="sd"> &#39;RayletSocketName&#39;: &#39;/tmp/ray/session_2020-08-04_18-18-16_481195_34255/sockets/raylet.1&#39;,</span>
<span class="sd"> &#39;Resources&#39;: {&#39;CPU&#39;: 1.0,</span>
<span class="sd">                &#39;memory&#39;: 134.0,</span>
<span class="sd">                &#39;node:192.168.1.82&#39;: 1.0,</span>
<span class="sd">                &#39;object_store_memory&#39;: 2.0},</span>
<span class="sd"> &#39;alive&#39;: True}]</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="grafana">
<span id="multi-node-metrics-grafana"></span><h2>Grafana<a class="headerlink" href="monitoring-and-observability.html#grafana" title="Permalink to this headline">#</a></h2>
<p>Ray dashboard integrates with Grafana to show visualizations of time-series metrics.</p>
<img alt="../../_images/graphs.png" class="align-center" src="../../_images/graphs.png" />
<p>First decide where to host Grafana. A common location is on the head node of the cluster.
See <a class="reference internal" href="../../ray-core/ray-metrics.html#grafana"><span class="std std-ref">instructions</span></a> for installing Grafana and using the default Grafana configurations
exported by Ray.</p>
<p>Next, the head node must be able to access Prometheus and Grafana, and the browser of the dashboard user
must be able to access Grafana. Configure these settings using the <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code>, <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_PROMETHEUS_HOST</span></code>,
and <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_IFRAME_HOST</span></code> environment variables.</p>
<ul class="simple">
<li><p>Set <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> to an address that the head node can use to access Grafana.</p></li>
<li><p>Set <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_PROMETHEUS_HOST</span></code> to an address the head node can use to access Prometheus.</p></li>
<li><p>You can set`RAY_GRAFANA_IFRAME_HOST` to an address for the user’s browsers to access Grafana. By default, <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_IFRAME_HOST</span></code> is equal to <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code>.</p></li>
</ul>
<p>For example, if the IP of the head node is 55.66.77.88 and Grafana is hosted on port 3000. Set the value
to <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST=55.66.77.88:3000</span></code>.</p>
<section id="using-an-existing-grafana-instance">
<span id="multi-node-metrics-grafana-existing"></span><h3>Using an existing Grafana instance<a class="headerlink" href="monitoring-and-observability.html#using-an-existing-grafana-instance" title="Permalink to this headline">#</a></h3>
<p>To use an existing Grafana instance, set up the environment variable <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> environment variable with a URL of your Grafana, before starting your Ray cluster. After starting Ray, find the Grafana dashboard JSON at <code class="xref py py-obj docutils literal notranslate"><span class="pre">/tmp/ray/session_latest/metrics/grafana/dashboards/default_grafana_dashboard.json</span></code>. <a class="reference external" href="https://grafana.com/docs/grafana/latest/dashboards/manage-dashboards/#import-a-dashboard">Import this dashboard</a> to your Grafana.</p>
<p>If Grafana reports that datasource is not found, you can <a class="reference external" href="https://grafana.com/docs/grafana/latest/dashboards/variables/add-template-variables/?pg=graf&amp;plcmt=data-sources-prometheus-btn-1#add-a-data-source-variable">add a datasource variable</a> and using <a class="reference external" href="https://grafana.com/docs/grafana/latest/dashboards/build-dashboards/modify-dashboard-settings/#view-dashboard-json-model">JSON model view</a> change all values of <code class="xref py py-obj docutils literal notranslate"><span class="pre">datasource</span></code> key in the imported <code class="xref py py-obj docutils literal notranslate"><span class="pre">default_grafana_dashboard.json</span></code> to the name of the variable. For example, if the variable name is <code class="xref py py-obj docutils literal notranslate"><span class="pre">data_source</span></code>, all <code class="xref py py-obj docutils literal notranslate"><span class="pre">&quot;datasource&quot;</span></code> mappings should be:</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="nt">&quot;datasource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prometheus&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;$data_source&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>When existing Grafana instance requires user authentication, the following settings have to be in its <a class="reference external" href="https://grafana.com/docs/grafana/latest/setup-grafana/configure-grafana/">configuration file</a> to correctly embed in Ray dashboard:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[security]</span><span class="w"></span>
<span class="na">allow_embedding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="na">cookie_secure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">true</span><span class="w"></span>
<span class="na">cookie_samesite</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">none</span><span class="w"></span>
</pre></div>
</div>
<p>If Grafana is exposed via nginx ingress on Kubernetes cluster, the following line should be present in the Grafana ingress annotation:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">nginx.ingress.kubernetes.io/configuration-snippet</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span><span class="w"></span>
<span class="w">    </span><span class="no">add_header X-Frame-Options SAMEORIGIN always;</span><span class="w"></span>
</pre></div>
</div>
<p>When both Grafana and Ray cluster are on the same Kubernetes cluster, it is important to set <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> to the external URL of the Grafana ingress. For successful embedding, <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> needs to be accessible to both Ray cluster backend and Ray dashboard frontend:</p>
<ul class="simple">
<li><p>On the backend, <em>Ray cluster head</em> does health checks on Grafana. Hence <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> needs to be accessible in the Kubernetes pod which is running the head node.</p></li>
<li><p>When accessing <em>Ray dashboard</em> from the browser, frontend embeds Grafana dashboard using the URL specified in <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code>. Hence <code class="xref py py-obj docutils literal notranslate"><span class="pre">RAY_GRAFANA_HOST</span></code> needs to be accessible from the browser as well.</p></li>
</ul>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="job-submission/ray-client.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Ray Client: Interactive Development</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="autoscaling/reference.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Programmatic Cluster Scaling</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>