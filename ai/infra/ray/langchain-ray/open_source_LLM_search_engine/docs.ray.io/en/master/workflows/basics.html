
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Getting Started &#8212; Ray 3.0.0.dev0</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css@digest=1999514e3f237ded88cf.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css@digest=5115cc725059bd94278eecd172e13a965bf8f5a9.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/termynal.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_/static/css/badge_only.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/versionwarning.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    <script defer="defer" src="../_static/js/docsearch.js"></script>
    <script src="../_static/js/rate-the-docs.es.min.js"></script>
    <script defer="defer" src="../_static/js/termynal.js"></script>
    <script defer="defer" src="../_static/js/custom.js"></script>
    <script defer="defer" src="../_static/js/top-navigation.js"></script>
    <script src="../_static/js/tags.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js@digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/design-tabs.js"></script>
    <script async="async" src="../../../_/static/javascript/readthedocs-doc-embed.js"></script>
    <link rel="canonical" href="https://docs.ray.io/en/latest/workflows/basics.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Workflow Management" href="management.html" />
    <link rel="prev" title="Key Concepts" href="key-concepts.html" />

<!-- Fathom - beautiful, simple website analytics -->
<script src="https://deer.ray.io/script.js" data-site="WYYANYOS" defer></script>
<!-- / Fathom -->

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110413294-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110413294-1');
</script>


  
<!-- RTD Extra Head -->

<link rel="stylesheet" href="../../../_/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.com", "build_date": "2023-04-28T22:35:08Z", "builder": "sphinx", "canonical_url": null, "commit": "ff36b8e7", "docroot": "/doc/source/", "features": {"docsearch_disabled": false}, "global_analytics_code": "UA-17997319-2", "language": "en", "page": "workflows/basics", "programming_language": "py", "project": "anyscale-ray", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_book_theme", "user_analytics_code": "", "version": "master"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="../../../_/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"><div class='topnav'></div></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Ray 3.0.0.dev0</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main Navigation">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../index.html">
                    Welcome to Ray!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Ray
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/index.html">
   Overview
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/getting-started.html">
   Getting Started Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-more-libs/installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/use-cases.html">
   Use Cases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-overview/ray-libraries.html">
   Ecosystem
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/walkthrough.html">
   Ray Core
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-air/getting-started.html">
   Ray AI Runtime (AIR)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../data/data.html">
   Ray Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../train/train.html">
   Ray Train
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../tune.html">
   Ray Tune
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../serve/index.html">
   Ray Serve
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../rllib/index.html">
   Ray RLlib
  </a>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../ray-more-libs/index.html">
   More Libraries
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="../joblib.html">
     Distributed Scikit-learn / Joblib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ray-more-libs/multiprocessing.html">
     Distributed multiprocessing.Pool
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ray-more-libs/ray-collective.html">
     Ray Collective Communication Lib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ray-more-libs/using-ray-with-pytorch-lightning.html">
     Using Ray with Pytorch Lightning
    </a>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Ray Workflows (Alpha)
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="key-concepts.html">
       Key Concepts
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="basics.html#">
       Getting Started
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="management.html">
       Workflow Management
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="metadata.html">
       Workflow Metadata
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="events.html">
       Events
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="comparison.html">
       API Comparisons
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="advanced.html">
       Advanced Topics
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="api/api.html">
       Ray Workflows API
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-core/cluster/index.html">
   Ray Clusters
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-observability/monitoring-debugging/monitoring-debugging.html">
   Monitoring and Debugging
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-references/api.html">
   References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../ray-contribute/stability.html">
   Developer Guides
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/ray-project/ray"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/issues/new?title=Issue%20on%20page%20%2Fworkflows/basics.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/ray-project/ray/edit/master/doc/source/workflows/basics.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/workflows/basics.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#your-first-workflow">
   Your first workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#setting-workflow-options">
   Setting workflow options
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#retrieving-workflow-results">
   Retrieving Workflow Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#sub-task-results">
     Sub-Task Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#error-handling">
   Error handling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#durability-guarantees">
   Durability guarantees
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#failure-model">
     Failure model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#dynamic-workflows">
   Dynamic workflows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#ray-integration">
   Ray Integration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#mixing-workflow-tasks-with-ray-tasks-and-actors">
     Mixing workflow tasks with Ray tasks and actors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#passing-nested-arguments">
     Passing nested arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#passing-object-references-between-tasks">
     Passing object references between tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#setting-custom-resources-for-tasks">
     Setting custom resources for tasks
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Getting Started</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#your-first-workflow">
   Your first workflow
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#setting-workflow-options">
   Setting workflow options
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#retrieving-workflow-results">
   Retrieving Workflow Results
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#sub-task-results">
     Sub-Task Results
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#error-handling">
   Error handling
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#durability-guarantees">
   Durability guarantees
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#failure-model">
     Failure model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#dynamic-workflows">
   Dynamic workflows
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="basics.html#ray-integration">
   Ray Integration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#mixing-workflow-tasks-with-ray-tasks-and-actors">
     Mixing workflow tasks with Ray tasks and actors
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#passing-nested-arguments">
     Passing nested arguments
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#passing-object-references-between-tasks">
     Passing object references between tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="basics.html#setting-custom-resources-for-tasks">
     Setting custom resources for tasks
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="getting-started">
<h1>Getting Started<a class="headerlink" href="basics.html#getting-started" title="Permalink to this headline">#</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Workflows is a library that provides strong durability for Ray task graphs.
If you’re brand new to Ray, we recommend starting with the <a class="reference internal" href="../ray-core/walkthrough.html#core-walkthrough"><span class="std std-ref">core walkthrough</span></a> instead.</p>
</div>
<section id="your-first-workflow">
<h2>Your first workflow<a class="headerlink" href="basics.html#your-first-workflow" title="Permalink to this headline">#</a></h2>
<p>Let’s start by defining a simple workflow DAG, which we’ll use for the below example.
Here is a single three-node DAG (note the use of <code class="docutils literal notranslate"><span class="pre">.bind(...)</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">.remote(...)</span></code>). The DAG will not be executed until further actions are
taken on it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">ray</span>

<span class="c1"># Define Ray remote functions.</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">preprocessing</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">aggregate</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Build the DAG:</span>
<span class="c1"># data -&gt; preprocessed_data -&gt; aggregate</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">read_data</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">preprocessed_data</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">aggregate</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">preprocessed_data</span><span class="p">)</span>
</pre></div>
</div>
<p>We can plot this DAG by using <code class="docutils literal notranslate"><span class="pre">ray.dag.vis_utils.plot(output,</span> <span class="pre">&quot;output.jpg&quot;)</span></code>:</p>
<a class="reference internal image-reference" href="../_images/basic.png"><img alt="../_images/basic.png" class="align-center" src="../_images/basic.png" style="width: 500px;" /></a>
<p>Next, let’s execute the DAG we defined and inspect the result:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># &lt;follow the previous code&gt;</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">workflow</span>

<span class="c1"># Execute the workflow and print the result.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">output</span><span class="p">))</span>

<span class="c1"># You can also run the workflow asynchronously and fetch the output via</span>
<span class="c1"># &#39;ray.get&#39;</span>
<span class="n">output_ref</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">output_ref</span><span class="p">))</span>
</pre></div>
</div>
<p>Each node in the original DAG becomes a workflow task. You can think of workflow
tasks as wrappers around Ray tasks that insert <em>checkpointing logic</em> to
ensure intermediate results are durably persisted. This enables workflow DAGs to
always resume from the last successful task on failure.</p>
</section>
<section id="setting-workflow-options">
<h2>Setting workflow options<a class="headerlink" href="basics.html#setting-workflow-options" title="Permalink to this headline">#</a></h2>
<p>You can directly set Ray options to a workflow task just like a normal
Ray remote function. To set workflow-specific options, use <code class="docutils literal notranslate"><span class="pre">workflow.options</span></code>
either as a decorator or as kwargs to <code class="docutils literal notranslate"><span class="pre">&lt;task&gt;.options</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">workflow</span>

<span class="nd">@workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_cpus</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">read_data</span><span class="p">(</span><span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num</span><span class="p">)]</span>

<span class="n">read_data_with_options</span> <span class="o">=</span> <span class="n">read_data</span><span class="o">.</span><span class="n">options</span><span class="p">(</span>
    <span class="n">num_cpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="retrieving-workflow-results">
<h2>Retrieving Workflow Results<a class="headerlink" href="basics.html#retrieving-workflow-results" title="Permalink to this headline">#</a></h2>
<p>To retrieve a workflow result, assign <code class="docutils literal notranslate"><span class="pre">workflow_id</span></code> when running a workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">workflow</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># Cleanup previous workflows</span>
    <span class="c1"># An exception will be raised if it doesn&#39;t exist.</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;add_example&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">workflow</span><span class="o">.</span><span class="n">WorkflowNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">left</span> <span class="o">+</span> <span class="n">right</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">get_val</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">10</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">get_val</span><span class="o">.</span><span class="n">bind</span><span class="p">(),</span> <span class="mi">20</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">workflow_id</span><span class="o">=</span><span class="s2">&quot;add_example&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span>
</pre></div>
</div>
<p>The workflow results can be retrieved with
<code class="docutils literal notranslate"><span class="pre">workflow.get_output(workflow_id)</span></code>. If a workflow is not given a
<code class="docutils literal notranslate"><span class="pre">workflow_id</span></code>, a random string is set as the <code class="docutils literal notranslate"><span class="pre">workflow_id</span></code>. To list all
workflow ids, call <code class="docutils literal notranslate"><span class="pre">ray.workflow.list_all()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">get_output</span><span class="p">(</span><span class="s2">&quot;add_example&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span>
<span class="c1"># &quot;workflow.get_output_async&quot; is an asynchronous version</span>
</pre></div>
</div>
<section id="sub-task-results">
<h3>Sub-Task Results<a class="headerlink" href="basics.html#sub-task-results" title="Permalink to this headline">#</a></h3>
<p>We can retrieve the results for individual workflow tasks too with <em>task id</em>. Task ID can be given with <code class="docutils literal notranslate"><span class="pre">task_id</span></code>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>via <code class="docutils literal notranslate"><span class="pre">.options(**workflow.options(task_id=&quot;task_name&quot;))</span></code></p></li>
<li><p>via decorator <code class="docutils literal notranslate"><span class="pre">&#64;workflow.options(task_id=&quot;task_name&quot;)</span></code></p></li>
</ol>
</div></blockquote>
<p>If tasks are not given <code class="docutils literal notranslate"><span class="pre">task_id</span></code>, the function name of the steps is set as the <code class="docutils literal notranslate"><span class="pre">task_id</span></code>.
If there are multiple tasks with the same id, a suffix with a counter <code class="docutils literal notranslate"><span class="pre">_n</span></code> will be added.</p>
<p>Once a task id is given, the result of the task will be retrievable via <code class="docutils literal notranslate"><span class="pre">workflow.get_output(workflow_id,</span> <span class="pre">task_id=&quot;task_id&quot;)</span></code>.
If the task with the given <code class="docutils literal notranslate"><span class="pre">task_id</span></code> hasn’t been executed before the workflow completes, an exception will be thrown. Here are some examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">workflow</span>

<span class="n">workflow_id</span> <span class="o">=</span> <span class="s2">&quot;double&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># cleanup previous workflows</span>
    <span class="n">workflow</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">)</span>
<span class="k">except</span> <span class="n">workflow</span><span class="o">.</span><span class="n">WorkflowNotFoundError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">v</span>

<span class="n">inner_task</span> <span class="o">=</span> <span class="n">double</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="n">workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">outer_task</span> <span class="o">=</span> <span class="n">double</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="n">workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">inner_task</span><span class="p">)</span>
<span class="n">result_ref</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run_async</span><span class="p">(</span><span class="n">outer_task</span><span class="p">,</span> <span class="n">workflow_id</span><span class="o">=</span><span class="s2">&quot;double&quot;</span><span class="p">)</span>

<span class="n">inner</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">get_output_async</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>
<span class="n">outer</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">get_output_async</span><span class="p">(</span><span class="n">workflow_id</span><span class="p">,</span> <span class="n">task_id</span><span class="o">=</span><span class="s2">&quot;outer&quot;</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">inner</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
<span class="k">assert</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">outer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
<span class="k">assert</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">result_ref</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span>
</pre></div>
</div>
</section>
</section>
<section id="error-handling">
<h2>Error handling<a class="headerlink" href="basics.html#error-handling" title="Permalink to this headline">#</a></h2>
<p>Workflow provides two ways to handle application-level exceptions: (1) automatic retry (as in normal Ray tasks), and (2) the ability to catch and handle exceptions.</p>
<ul class="simple">
<li><p>If <code class="docutils literal notranslate"><span class="pre">max_retries</span></code> is given, the task will be retried for the given number of times if the workflow task failed.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">retry_exceptions</span></code> is True, then the workflow task retries both task crashes and application-level errors;
if it is <code class="docutils literal notranslate"><span class="pre">False</span></code>, then the workflow task only retries task crashes.</p></li>
<li><p>If <code class="docutils literal notranslate"><span class="pre">catch_exceptions</span></code> is True, the return value of the function will be converted to <code class="docutils literal notranslate"><span class="pre">Tuple[Optional[T],</span> <span class="pre">Optional[Exception]]</span></code>.
It can be combined with <code class="docutils literal notranslate"><span class="pre">max_retries</span></code> to retry a given number of times before returning the result tuple.</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">max_retries</span></code> and <code class="docutils literal notranslate"><span class="pre">retry_exceptions</span></code> are also Ray task options,
so they should be used inside the Ray remote decorator. Here is how you could use them:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># specify in decorator</span>
<span class="nd">@workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">faulty_function</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="c1"># specify in .options()</span>
<span class="n">faulty_function</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">retry_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="o">**</span><span class="n">workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default <code class="docutils literal notranslate"><span class="pre">retry_exceptions</span></code> is <code class="docutils literal notranslate"><span class="pre">False</span></code>, and <code class="docutils literal notranslate"><span class="pre">max_retries</span></code> is <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p>
</div>
<p>Here is one example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">ray</span>
<span class="kn">from</span> <span class="nn">ray</span> <span class="kn">import</span> <span class="n">workflow</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">faulty_function</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;oops&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s2">&quot;OK&quot;</span>

<span class="c1"># Tries up to five times before giving up.</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">faulty_function</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">r1</span><span class="p">)</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">handle_errors</span><span class="p">(</span><span class="n">result</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">]):</span>
    <span class="c1"># The exception field will be None on success.</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;There was an error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;OK&quot;</span>

<span class="c1"># `handle_errors` receives a tuple of (result, exception).</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">faulty_function</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="o">**</span><span class="n">workflow</span><span class="o">.</span><span class="n">options</span><span class="p">(</span><span class="n">catch_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">handle_errors</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="durability-guarantees">
<h2>Durability guarantees<a class="headerlink" href="basics.html#durability-guarantees" title="Permalink to this headline">#</a></h2>
<p>Workflow tasks provide <em>exactly-once</em> execution semantics. What this means is
that <strong>once the result of a workflow task is logged to durable storage, Ray
guarantees the task will never be re-executed</strong>. A task that receives the output
of another workflow task can be assured that its inputs tasks will never be
re-executed.</p>
<section id="failure-model">
<h3>Failure model<a class="headerlink" href="basics.html#failure-model" title="Permalink to this headline">#</a></h3>
<ul class="simple">
<li><p>If the cluster fails, any workflows running on the cluster enter <code class="docutils literal notranslate"><span class="pre">RESUMABLE</span></code> state. The workflows can be resumed on another cluster (see the management API section).</p></li>
<li><p>The lifetime of the workflow is not coupled with the driver. If the driver exits, the workflow will continue running in the background of the cluster.</p></li>
</ul>
<p>Note that tasks that have side effects still need to be idempotent. This is because the task could always fail before its result is logged.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">Non-idempotent workflow:</span><a class="headerlink" href="basics.html#id1" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">book_flight_unsafe</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">FlightTicket</span><span class="p">:</span>
    <span class="n">ticket</span> <span class="o">=</span> <span class="n">service</span><span class="o">.</span><span class="n">book_flight</span><span class="p">()</span>
    <span class="c1"># Uh oh, what if we failed here?</span>
    <span class="k">return</span> <span class="n">ticket</span>

<span class="c1"># UNSAFE: we could book multiple flight tickets</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">book_flight_unsafe</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">Idempotent workflow:</span><a class="headerlink" href="basics.html#id2" title="Permalink to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">generate_id</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
   <span class="c1"># Generate a unique idempotency token.</span>
   <span class="k">return</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">book_flight_idempotent</span><span class="p">(</span><span class="n">request_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FlightTicket</span><span class="p">:</span>
   <span class="k">if</span> <span class="n">service</span><span class="o">.</span><span class="n">has_ticket</span><span class="p">(</span><span class="n">request_id</span><span class="p">):</span>
       <span class="c1"># Retrieve the previously created ticket.</span>
       <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">get_ticket</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span>
   <span class="k">return</span> <span class="n">service</span><span class="o">.</span><span class="n">book_flight</span><span class="p">(</span><span class="n">request_id</span><span class="p">)</span>

<span class="c1"># SAFE: book_flight is written to be idempotent</span>
<span class="n">request_id</span> <span class="o">=</span> <span class="n">generate_id</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span>
<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">book_flight_idempotent</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">request_id</span><span class="p">))</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="dynamic-workflows">
<h2>Dynamic workflows<a class="headerlink" href="basics.html#dynamic-workflows" title="Permalink to this headline">#</a></h2>
<p>Workflow tasks can be dynamically created in the runtime. In theory, Ray DAG is
static which means a DAG node can’t be returned in a DAG node. For example, the
following code is invalid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span> <span class="o">...</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">bar</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span> <span class="c1"># This is invalid since Ray DAG is static</span>

<span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span> <span class="c1"># This will error</span>
</pre></div>
</div>
<p>Workflow introduces a utility function called <code class="docutils literal notranslate"><span class="pre">workflow.continuation</span></code> which
makes Ray DAG node can return a DAG in the runtime:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">bar</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">10</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">foo</span><span class="p">():</span>
    <span class="c1"># This will return a DAG to be executed</span>
    <span class="c1"># after this function is finished.</span>
    <span class="k">return</span> <span class="n">workflow</span><span class="o">.</span><span class="n">continuation</span><span class="p">(</span><span class="n">bar</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>

<span class="k">assert</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span> <span class="o">==</span> <span class="mi">10</span>
</pre></div>
</div>
<p>The dynamic workflow enables nesting, looping, and recursion within workflows.</p>
<p>The following example shows how to implement the recursive <code class="docutils literal notranslate"><span class="pre">factorial</span></code> program
using dynamically workflow:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Here a DAG is passed to the continuation.</span>
        <span class="c1"># The DAG will continue to be executed after this task.</span>
        <span class="k">return</span> <span class="n">workflow</span><span class="o">.</span><span class="n">continuation</span><span class="p">(</span><span class="n">multiply</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">factorial</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)))</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>

<span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">factorial</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="mi">3628800</span>
<span class="c1"># You can also execute the code with Ray DAG engine.</span>
<span class="k">assert</span> <span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">factorial</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3628800</span>
</pre></div>
</div>
<p>The key behavior to note is that when a task returns a DAG wrapped by
<code class="docutils literal notranslate"><span class="pre">workflow.continuation</span></code> instead of a concrete value, that wrapped DAG will be
substituted for the task’s return.</p>
<p>To better understand dynamic workflows, let’s look at a more realistic example of booking a trip:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">book_flight</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Flight</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">book_hotel</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Hotel</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">finalize_or_cancel</span><span class="p">(</span>
    <span class="n">flights</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Flight</span><span class="p">],</span>
    <span class="n">hotels</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Hotel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Receipt</span><span class="p">:</span> <span class="o">...</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">book_trip</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dest</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Receipt</span><span class="p">:</span>
    <span class="c1"># Note that the workflow engine will not begin executing</span>
    <span class="c1"># child workflows until the parent task returns.</span>
    <span class="c1"># This avoids task overlap and ensures recoverability.</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">book_flight</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">f2</span> <span class="o">=</span> <span class="n">book_flight</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">dates</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">hotel</span> <span class="o">=</span> <span class="n">book_hotel</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">dates</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">workflow</span><span class="o">.</span><span class="n">continuation</span><span class="p">(</span><span class="n">finalize_or_cancel</span><span class="o">.</span><span class="n">bind</span><span class="p">([</span><span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">],</span> <span class="p">[</span><span class="n">hotel</span><span class="p">]))</span>

<span class="n">receipt</span><span class="p">:</span> <span class="n">Receipt</span> <span class="o">=</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">book_trip</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="s2">&quot;OAK&quot;</span><span class="p">,</span> <span class="s2">&quot;SAN&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;6/12&quot;</span><span class="p">,</span> <span class="s2">&quot;7/5&quot;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Here the workflow initially just consists of the <code class="docutils literal notranslate"><span class="pre">book_trip</span></code> task. Once
executed, <code class="docutils literal notranslate"><span class="pre">book_trip</span></code> generates tasks to book flights and hotels in parallel,
which feeds into a task to decide whether to cancel the trip or finalize it. The
DAG can be visualized as follows (note the dynamically generated nested
workflows within <code class="docutils literal notranslate"><span class="pre">book_trip</span></code>):</p>
<a class="reference internal image-reference" href="../_images/trip.png"><img alt="../_images/trip.png" class="align-center" src="../_images/trip.png" style="width: 500px;" /></a>
<p>The execution order here will be:
1. Run the <code class="docutils literal notranslate"><span class="pre">book_trip</span></code> task.
2. Run the two <code class="docutils literal notranslate"><span class="pre">book_flight</span></code> tasks and the <code class="docutils literal notranslate"><span class="pre">book_hotel</span></code>  task in parallel.
3. Once all three booking tasks finish, <code class="docutils literal notranslate"><span class="pre">finalize_or_cancel</span></code> will be executed and its return will be the output of the workflow.</p>
</section>
<section id="ray-integration">
<h2>Ray Integration<a class="headerlink" href="basics.html#ray-integration" title="Permalink to this headline">#</a></h2>
<section id="mixing-workflow-tasks-with-ray-tasks-and-actors">
<h3>Mixing workflow tasks with Ray tasks and actors<a class="headerlink" href="basics.html#mixing-workflow-tasks-with-ray-tasks-and-actors" title="Permalink to this headline">#</a></h3>
<p>Workflows are compatible with Ray tasks and actors. There are two methods of using them together:</p>
<ol class="arabic simple">
<li><p>Workflows can be launched from within a Ray task or actor. For example, you can launch a long-running workflow from Ray serve in response to a user request. This is no different from launching a workflow from the driver program.</p></li>
<li><p>Workflow tasks can use Ray tasks or actors within a single task. For example, a task could use Ray Train internally to train a model. No durability guarantees apply to the tasks or actors used within the task; if the task fails, it will be re-executed from scratch.</p></li>
</ol>
</section>
<section id="passing-nested-arguments">
<h3>Passing nested arguments<a class="headerlink" href="basics.html#passing-nested-arguments" title="Permalink to this headline">#</a></h3>
<p>Like Ray tasks, when you pass a list of task outputs to a task, the values are
not resolved. But we ensure that all ancestors of a task are fully executed
before the task starts which is different from passing them into a Ray remote
function whether they have been executed or not is not defined.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ray</span><span class="o">.</span><span class="n">ObjectRef</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="c1"># although those values are not resolved, they have been</span>
    <span class="c1"># *fully executed and checkpointed*. This guarantees exactly-once</span>
    <span class="c1"># execution semantics.</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">get_val</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="k">return</span> <span class="mi">10</span>

<span class="n">ret</span> <span class="o">=</span> <span class="n">add</span><span class="o">.</span><span class="n">bind</span><span class="p">([</span><span class="n">get_val</span><span class="o">.</span><span class="n">bind</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)])</span>
<span class="k">assert</span> <span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">==</span> <span class="mi">30</span>
</pre></div>
</div>
</section>
<section id="passing-object-references-between-tasks">
<h3>Passing object references between tasks<a class="headerlink" href="basics.html#passing-object-references-between-tasks" title="Permalink to this headline">#</a></h3>
<p>Ray object references and data structures composed of them (e.g.,
<code class="docutils literal notranslate"><span class="pre">ray.Dataset</span></code>) can be passed into and returned from workflow tasks. To ensure
recoverability, their contents will be logged to durable storage before
executing. However, an object will not be checkpointed more than once, even if
it is passed to many different tasks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">do_add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>

<span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span>
<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">do_add</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>

<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">add</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">ray</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="mi">20</span><span class="p">)))</span> <span class="o">==</span> <span class="mi">30</span>
</pre></div>
</div>
<p>Ray actor handles are not allowed to be passed between tasks.</p>
</section>
<section id="setting-custom-resources-for-tasks">
<h3>Setting custom resources for tasks<a class="headerlink" href="basics.html#setting-custom-resources-for-tasks" title="Permalink to this headline">#</a></h3>
<p>You can assign resources (e.g., CPUs, GPUs to tasks via the same <code class="docutils literal notranslate"><span class="pre">num_cpus</span></code>, <code class="docutils literal notranslate"><span class="pre">num_gpus</span></code>, and <code class="docutils literal notranslate"><span class="pre">resources</span></code> arguments that Ray tasks take):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@ray</span><span class="o">.</span><span class="n">remote</span><span class="p">(</span><span class="n">num_gpus</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">train_model</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
    <span class="k">pass</span>  <span class="c1"># This task is assigned to a GPU by Ray.</span>

<span class="n">workflow</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">train_model</span><span class="o">.</span><span class="n">bind</span><span class="p">())</span>
</pre></div>
</div>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="key-concepts.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Key Concepts</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="management.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Workflow Management</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By The Ray Team<br/>
  
      &copy; Copyright 2023, The Ray Team.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js@digest=1999514e3f237ded88cf"></script>


  </body>
</html>